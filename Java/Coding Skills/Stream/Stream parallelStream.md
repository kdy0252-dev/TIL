---
id: Stream parallelStream
started: 2025-04-25
tags:
  - ✅DONE
  - Java
group: "[[Java Coding Skills]]"
---
# Stream parallelStream
## Stream은 병렬로 수행이 가능하다.

```java title="Parallel Stream 예시"
hexList.parallelStream()
              .map(Parser::parse)
              .map(Processor::new)
              .toList();
```
**Parallel Stream 이란?**
`parallelStream()`은 스트림을 병렬로 처리할 수 있게 해주는 메서드이다. 여러 스레드를 사용하여 스트림의 요소들을 동시에 처리하므로, 대량의 데이터를 처리할 때 성능 향상을 기대할 수 있다.
## 어떤 경우에 parallelStream을 사용하면 성능 향상이 있을까?
1.  **대량의 데이터 처리**: 데이터의 양이 충분히 많아야 병렬 처리의 효과를 볼 수 있다. 일반적으로 수십만 건 이상의 데이터에서 효과가 나타난다.
2.  **CPU 바운드 작업**: 각 요소에 대한 연산이 CPU 연산을 많이 필요로 하는 경우에 효과적이다. I/O 작업이 많은 경우에는 오히려 성능이 저하될 수 있다.
3.  **독립적인 연산**: 각 요소에 대한 연산이 서로 독립적이어야 한다. 공유 자원에 접근하거나 순서가 중요한 연산에서는 병렬 처리의 효과를 보기 어렵다.
## parallelStream은 비동기적으로 동작할까? 동기적으로 동작할까?
`parallelStream`은 내부적으로 ForkJoinPool을 사용하여 작업을 병렬로 처리한다. ForkJoinPool은 작업을 작은 단위로 분할하고, 각 작업을 스레드 풀의 스레드에 할당하여 병렬로 실행한다.
*   **비동기적 동작**: 각 작업은 스레드 풀의 스레드에 의해 비동기적으로 실행된다. 즉, 각 스레드는 독립적으로 작업을 수행하고, 작업이 완료되는 순서는 보장되지 않는다.
*   **동기적 대기**: `collect()`와 같은 최종 연산(Terminal Operation)을 호출하면, 모든 작업이 완료될 때까지 기다린다. 즉, 최종 결과는 모든 작업이 완료된 후에 반환된다.
## 내부 구현 (대략적인 부분)
1.  **분할(Fork)**: 스트림의 요소를 작은 단위로 분할한다.
2.  **할당(Assign)**: 각 분할된 작업을 ForkJoinPool의 스레드에 할당한다.
3.  **병렬 처리(Parallel Processing)**: 각 스레드는 할당된 작업을 병렬로 처리한다.
4.  **합병(Join)**: 모든 작업이 완료되면, 각 스레드의 결과를 합쳐서 최종 결과를 생성한다.
## 주의할 점
1.  **공유 자원**: 여러 스레드가 공유 자원에 동시에 접근하면 Race Condition이 발생할 수 있다. 공유 자원에 접근할 때는 동기화 메커니즘을 사용하여 스레드 안전성을 확보해야 한다.
2.  **순서**: `parallelStream`은 요소의 처리 순서를 보장하지 않는다. 순서가 중요한 연산에서는 `parallelStream`을 사용하면 안 된다.
3.  **오버헤드**: `parallelStream`은 스레드를 생성하고 관리하는 오버헤드가 있다. 데이터의 양이 적거나 연산이 간단한 경우에는 오히려 성능이 저하될 수 있다.

# Reference