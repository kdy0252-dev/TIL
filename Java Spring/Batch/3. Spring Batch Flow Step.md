---
id: 3. Spring Batch Flow Step
started: 2025-02-24
last modified: 2025-02-24
tags:
  - ✅DONE
group: "[[Java Spring Batch]]"
---
# Spring Batch Flow Step

## FlowStep
### Transition - on() / to() / stop() ,fail(), end(), stopAndRestart()
#### Transition
- Flow 내 Step의 조건부 전환(전이) 를 정의함
- Job의 API설정에서 on(String pattern) 메소드를 호출하면 TransitionBuilder가 반환되어  
    Transition Flow를 구성할 수 있음
- Step의 종료상태(ExitStatus) 가 어떤 pattern 과도 매칭이되지않으면 스프링 배치에서 예외를 발생하고 Job은 실패
- transition 은 구체적인 것 부터 그렇지 않은 순서로 적용된다
### API
on
- Step의 실행결과로 돌려받는 종료 상태(ExitStatus) 와 매칭하는 패턴 스키마 , BatchStatus 와 매칭하는것이 아님
- pattern 과 ExitStatus가 매칭이되면 다음으로 실행할 Step을 지정할 수 있다.
- 특수문자는 2가지만 허용
- * = 0 개이상의 모든 문자
- ? = 1개의 문자
to  = 다음으로 실행할 단계를 지정
from = 이전 단계에서 정의한 Transition 을 새롭게 추가 정의함
#### Job을 중단하거나 종료하는 Transition API
- Flow가 실행되면 FlowExecutionStatus 에 상태값이 저장되고 최종적으로 Job의 BatchStatus 와 ExitStatus 에 반영된다.
- Step의 BatchStatus 및 ExitStatus 에는 아무런 영향을 주지 않고 Job의 상태만을 번경한다.

stop
- FlowExecutionStatus 가 stopped 상태로 종료되는 transition
- Job의 BatchStatus 와 ExitStatus 가 stopped 으로 종료됨
fail
- FlowExecutionStatus가 failed 상태로 종료되는 transition
- Job의 BatchStatus 와 ExitStatus 가 failed 으로 종료됨
end
- FlowExecutionStatus가 completed 상태로 종료되는 transition
- Job의 BatchStatus 와 ExitStatus 가 completed 으로 종료됨
- Step의 ExitStatus가 failed 이더라도 job의 batchstuats는 completed 로 종료하도록 가능하며  
    이때 Job의 재시작은 불가능함
stopAndRestart
- stop과 기본흐름은 동일
- 특정 step 에서 작업을 중단하도록 설정하면 중단 이전의 Step만 completed 로 저장되고 이후의 step은 실행되지 않고 stopped 상태로 job 종료
- job이 다시 실행됐을 때 실행해야할 Step을 restart 인자로 넘기면 이전에 completed 로 저장된 step 은 건너뛰고 중단이후 step 부터 시작한다.

![[Pasted image 20250224091115.png]]

![[Pasted image 20250224091139.png]]

예시 코드
```Java title="Flow Step 예시 코드"
@Bean
public Job batchJob() {
    return jobBuilderFactory.get("batchJob")
            .start(step1())
            .on("COMPLETED").to(step2())
            .from(step1())
            .on("FAILED").to(step3())
            .end()
            .build();
}
```
# Reference

[스프링 배치 실행 - Flow](https://tonylim.tistory.com/432)