---
id: Docker Local Registry 설치
started: 2025-02-25
last modified: 2025-02-25
tags:
  - ✅DONE
  - Docker
group:
  - "[[K8S]]"
---
# Docker Local Registry 설치
## Docker Private Registry 설치
```shell
docker pull registry
docker images
docker run --restart always -d -p 5000:5000 --name ieee160921-registry registry
docker ps
```
아래와 같이 출력된다.
```
CONTAINER ID   IMAGE      COMMAND                   CREATED         STATUS         PORTS                                       NAMES
15e523a02349   registry   "/entrypoint.sh /etc…"   4 seconds ago   Up 3 seconds   0.0.0.0:5000->5000/tcp, :::5000->5000/tcp   ieee160921-registry
```
### Docker Image에 Tag 설정
#### Docker Image Pull
```shell title="hello-world image pull 받는다."
docker pull hello-world
```
#### 이미지에 태그 설정
외부에서 리포지토리에 push 하려면 Tag를 달아야한다.
```shell title="docker image에 tag설정 예시"
docker tag hello-world 192.168.0.41:5000/hello-world
```
### HTTP로 Local Registry에 Push 하도록 설정
~/.docker/daemon.json 파일 아래와 같이 수정 후 docker service 재시작
```json title="~/.docker/daemon.json 파일에 insecure-registries 추가"
{
  "builder": {
    "gc": {
      "defaultKeepStorage": "20GB",
      "enabled": true
    }
  },
  "experimental": false,
  "insecure-registries": [
    "192.168.0.41:5000"
  ]
}
```
Local Registry **Server(Master와 Worker 모두에서)** 쪽에서도 똑같이 설정 후 서비스 재시작
```shell title="server에서 docker 재시작"
systemctl restart docker
```
### ContainerD Config 설정 (**모든 노드에서**)
```shell title="containerD 설정 후 재시작"
vim /etc/containerd/config.toml

# 해당하는 부분 아래에 라인 추가 후 저장
[plugins."io.containerd.grpc.v1.cri".registry.mirrors]
	[plugins."io.containerd.grpc.v1.cri".registry.mirrors."192.168.0.41:5000"]
          endpoint=["http://192.168.0.41:5000"]

systemctl restart containerd
```

> [!INFO] 위 과정 꼭 진행할것!
> WorkerNode에서 이거 설정 안하면 나중에 Repository에서 이미지 못가져감
### Image Push
```shell title="docker image Push"
docker push 192.168.0.41:5000/hello-world
```
### Local Repository 확인 및 삭제 방법
#### 내부 리포지토리 확인
```shell title="docker local registry 내부 리포지토리 확인"
curl -XGET 192.168.0.41:5000/v2/_catalog
```
#### 내부 리포지토리 삭제
```shell title="docker local Registry 내부의 리포지토리 삭제"
docker exec -it ieee160921-registry sh

cd /var/lib/registry/docker/registry/v2/repositories 내부에서 삭제
```

# Reference