---
id: 5. Offline 환경일 경우
started: 2025-03-13
tags:
  - ✅DONE
group:
  - "[[K8S]]"
---
# 5. Offline 환경일 경우
## 저장소 Pull 옵션 설정
- Helm으로 Deployment를 설치하면 Pod가 생성될때 Image를 기반으로 Container를 생성하게 되는데 우리가 사용중인 서비스들은 Online상에 있는 원격 저장소를 Pull 받아서 사용하도록 되어있다.
  따라서 Offline에서는 이 설정을 Image가 로컬에 이미 Pull 받아져 있는 경우에는 로컬의 이미지를 사용하도록 변경 하여야 한다.

- 해당 설정은 helm chart의 values.yaml에 존재하는데 각각의 서비스마다 imagePullPolicy 옵션을 always가 아닌 IfNotPresent로 설정해주면된다. custom으로 따로 작성해도 된다.
```yaml title="이미지 pull Policy 예시"
service-name:
  pullPolicy: IfNotPresent
```

- 다만 위 설정 사용 시 주의해야 할 점은 이미지가 해당 워커노드에 설치되어야 한다는 단점이 있다.
  따라서 모든 노드에 이미지를 설치하거나 해당 이미지가 있는 노드를 설정파일에 기록하면 된다.
```yaml title="이미지 직접 설정"
image:
  repository: master-node-address:5000/your-image
  tag: your-image-tag
  pullPolicy: IfNotPresent
```

- DaemonSet이라는 방법을 사용하여 모든 노드에 이미지를 Pull 받을 수도 있다.
## CDN 설정
- 웹 서버가 폐쇄망의 Offline 환경의 경우 CDN에 호스팅된 Js 파일이나 Font를 로딩하지 못한다. 따라서 해당 파일들을 미리 다운로드 받아 해당 파일을 사용하도록 설정해야한다.
# Reference