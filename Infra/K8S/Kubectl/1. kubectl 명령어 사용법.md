---
id: kubectl 명령어 사용법
started: 2025-02-26
last modified: 2025-02-26
tags:
  - ✅DONE
  - k8s
---
# kubectl 명령어 사용법

## Cluster 관련 명령어
```shell title="cluster 정보 출력"
#클러스터의 기본 정보를 볼 수 있다.
kubectl cluster-info

#클러스터의 기본 설정을 볼 수 있다.
kubectl config view

#클러스터의 상세 정보를 출력하는 명령어이나 매우 길기에 다 보기 힘들다.
kubectl cluster-info dump

#api server ip를 보려면 아래와 같이 grep 해준다.
kubectl cluster-info dump | grep advertise-address

#클러스터의 이벤트 정보를 보고 싶으면 아래 명령어 실행.(네임스페이스로도 필터가능)
kubectl get events --sort-by='.metadata.creationTimestamp' -A
```
## API Server 관련 커맨드
```shell title="API Server 관련 커맨드"
#워커노드에서 아래와 같이 api server로 curl을 날려 테스트 해볼 수 있다.
curl -k https://<API_SERVER_DNS_NAME>:<PORT>/version

#만약 DNS로 설정되어 있는 경우 DNS 설정이 잘 되어있는지 확인하려면
nslookup <API_SERVER_DNS_NAME>

#api server에 문제가 있다면 아래 명령어로 로그를 확인 할 수 있음.
journalctl -u kube-apiserver
#또는 kubeadm을 사용한 경우 `/var/log` 디렉터리의 로그 파일을 확인할 수 있음.

#네트워크 플러그인(예: Calico, Flannel, Weave 등)이 잘 설치되어있는지 확인하려면
kubectl get pods -n kube-system -l k8s-app=<CNI_PLUGIN_NAME>
```
## NameSpace 커맨드
```
kubectl create namespace calico-system
```
## Join 커맨드
```shell title="join commend"
kubeadm token create --print-join-command
```
## Pod 관련 커맨드
### Node의 정보 확인
```shell title="Node의 정보 확인"
#모든 노드의 정보를 가져온다
kubectl get node -A -o wide

#노드의 정보를 yaml 형태로 출력한다.
kubectl get node exscms2 -o yaml

# 파이프를 이용해서 grep으로  
kubectl get node exscms2 -o yaml | grep containerRuntimeVersion
```
### 클러스터에서 노드 삭제
```shell title="cluster에서 node 삭제"
kubectl delete node <node-name>
```
### Pod의 상태 확인
```shell title="Pod의 정보 확인"
# 전체를 조회하려면 -A 옵션을 주면 된다.
kubectl get pods -A

#-n 옵션으로 네임스페이스를 줄 수 있고 -o wide 옵션으로 자세하게 볼 수 있다.
kubectl get pod -o wide -n <namespace>

#watch를 앞에 붙히면 계속해서 볼 수 있다.
watch kubectl get pod -o wide -n <namespace>

#아래와 같이 파드의 연결정보를 볼 수 있다.
kubectl get svc -n argocd
```
### Pod의 상세 정보 확인
```shell title="Pod의 상세 정보 확인"
#아래와 같이 파드 자체의 상세정보를 알 수 있다.
kubectl describe pod <pod-name> -n <namespace>

#아래와 같이 파드의 로그를 볼 수 있다.
kubectl logs <pod-name> -n <namespace>

#-c 옵션을 주면 특정 컨테이너의 로그만 볼 수도 있다.
kubectl logs <pod-name> -c <container-name> -n <namespace>

# Pod 내부에서 명령어 실행시키려면 아래와 같이 하면 됨
kubectl exec -n <namespace> -it <pod-name> -- \
	<commend>
```
### Pod 강제 종료
```shell title="pod 삭제"
kubectl delete pod <pod-name> -n default
```
### Deployment 전체 재시작
```shell title="deployment 전체 재시작(매우 주의할 것)"
kubectl rollout restart deployment <deployment-name> -n <namespace>
```
## 환경변수 설정
```shell title="아래와 같이 환경 변수를 설정 할 수 있다."
#아래 명령은 eno로 시작되는 네트워크 인터페이스를 무시하라는 환경변수를 주입한 것이다.
kubectl set env daemonset/calico-node -n calico-system IP_AUTODETECTION_METHOD=skip-interface=eno*

#아래 명령은 네트워크 인터페이스를 bond0를 사용하라는 뜻이다.
kubectl set env daemonset/calico-node -n calico-system IP_AUTODETECTION_METHOD=interface=bond.*

kubectl set env daemonset/calico-node -n kube-system IP_AUTODETECTION_METHOD=can-reach=10.19.2.171
```
## Deployment 확인 방법
```shell title="deployment 확인 커맨드"
kubectl get deployments -A
```
## 이미지 확인(ContainerD 사용시)
```shell title="containerD 사용 시 이미지 확인"
ctr -n=k8s.io images list
```
# Reference